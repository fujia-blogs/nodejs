# 后台服务

1，服务：RESTful 和 RPC

2，服务分类，如下

[后台服务分类](assets/images/service-category.jpg)

- 网关：处理请求转发和一些通用的逻辑，如：Nginx

- 处理业务相关的逻辑，如：一些通用的协议转化，通用的鉴权处理以及其它统一的业务安全处理等

- 运营系统：日常运营活动

- 业务系统：负责核心的业务功能的系统

- 中台服务：负责一些通用 App 类的服务，如：配置下发，消息系统及用户反馈系统

- 基础层：较单一的核心后台服务，如：用户模块，需要根据不同业务设计不同的核心底层服务

3，寻找⽹络 I/O 较多，但是 CPU 计算较少、业务复杂度⾼的服务，基于这点可以
分析出 Node.js 应⽤在**业务⽹关**、**中台服务**及**运营系统**⼏个⽅⾯

4，从系统的**业务场景**和**系统特性**来分析

5，node.js 核心是不阻塞主线程处理，而业务网关都是轻 CPU 运算服务，在这类场景技术选型中可以考虑使用 node.js 作为服务端语言

## 中台服务

1，在 Web 或者 App 应⽤中都存在⼀些通⽤服务，以往都是独⽴接⼝、独⽴开发。随着公司应⽤越来越多，需要将⼀些通⽤的业务服务进⾏集中，这也是中台的概念。⽽这部分业务场景往往也是⽹络 I/O ⾼、并发较⼤、业务关联性⾼、数据库读写压⼒相对较⼩

[中台服务系统](assets/images/service-category.jpg)

- **前端配置系统**是在服务端根据客户端的版本、设备、地区和语⾔，下发不同的配置（JSON 或者⽂件包）；
- **反馈系统**，即⽤户可以在任何平台，调⽤反馈接⼝，并将反馈内容写⼊队列，并落地到系统中进⾏综合分析；
- **推送系统**⽤于管理消息的推送、⽤户红点和消息数的拉取，以及消息列表的管理；
- **系统⼯具**⽤于处理⽤户端⽇志捞取、⽤户端信息调试上报、性能定位问题分析提取等。

2，在中台系统设计中，系统着重关注：

- 网络 I/O
- 并发性
- 通用性
- 业务复杂度

一般情况下不涉及复杂的 CPU 运算

3，服务特性

[系统特性说明](assets/images/system-features-description.jpg)

4，node.js 作为中台服务的要求是：

- 通用性必须好
- 低 CPU 计算
- 网络 I/O 高或低皆可
- 并发高或低皆可

这样的服务在 node.js 主线程中，可快速处理各类业务场景不会存在阻塞的情况，这类场景也适合使用 node.js 作为服务端语言

## node.js 不适合场景

1，⼀些密集型 CPU 运算的服务则⾮常不适合使⽤ Node.js 来处理，如：

- 图⽚处理，⽐如图⽚的裁剪、图⽚的缩放，这些⾮常损耗 CPU 计算，应该⽤其他进程来处理
- ⼤字符串、⼤数组类处理，当涉及这些数据时，应该考虑如何通过切割来处理，或者在其他进程异步处理；
- ⼤⽂件读写处理，有时会使⽤ Node.js 服务来处理 Excel，但是遇到 Excel 过⼤时，会导致 Node.js 内存溢出，因为 V8 内存上限是 1.4G

两个关键因素：**大内存和 CPU 密集**，这样的场景都不适合使用 node.js 来提供服务

**减少或者避免在 node.js 主线程中被阻塞或进行一些 CPU 密集型计算**，遵循了这个原理
后，就可以拓展出⼀些业务复杂度⾼、业务迭代快的功能，或者⼀些通⽤性服务
